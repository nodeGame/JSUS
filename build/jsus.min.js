/**
 * # JSUS: JavaScript UtilS.
 * Copyright(c) 2017 Stefano Balietti <ste@nodegame.org>
 * MIT Licensed
 *
 * Collection of general purpose javascript functions. JSUS helps!
 *
 * See README.md for extra help.
 * ---
 */
(function(e){var t=e.JSUS={};t._classes={},"undefined"==typeof console&&(console={}),"undefined"==typeof console.log&&(console.log=function(){}),t.log=function(e){console.log(e)},t.extend=function(e,n){var r,i;if("object"!=typeof e&&"function"!=typeof e)return n;"undefined"==typeof n&&(n=n||this,"function"==typeof e?(r=e.toString(),r=r.substr("function ".length),r=r.substr(0,r.indexOf("("))):r=e.constructor||e.__proto__.constructor,r&&(this._classes[r]=e));for(i in e)e.hasOwnProperty(i)&&(typeof n[i]!="object"?n[i]=e[i]:t.extend(e[i],n[i]));return e.prototype&&t.extend(e.prototype,n.prototype||n),n},t.require=function(e,n){var r;n="undefined"==typeof n?!0:n;if(n&&"undefined"==typeof t.clone)return t.log("JSUS.require: JSUS.clone not found, but clone requested. Cannot continue."),!1;if("undefined"==typeof e)r=t._classes;else{r=t._classes[e];if("undefined"==typeof r)return t.log("JSUS.require: could not find component "+e),!1}return n?t.clone(r):r},t.isNodeJS=function(){return"undefined"!=typeof module&&"undefined"!=typeof module.exports&&"function"==typeof require},t.isNodeJS()?(require("./lib/compatibility"),require("./lib/obj"),require("./lib/array"),require("./lib/time"),require("./lib/eval"),require("./lib/dom"),require("./lib/random"),require("./lib/parse"),require("./lib/queue"),require("./lib/fs")):e.J=e.JSUS})("undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports:window),function(e){"use strict";function t(){}Array.prototype.filter||(Array.prototype.filter=function(e){if(this===void 0||this===null)throw new TypeError;var t=new Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=[],i=arguments[1];for(var s=0;s<n;s++)if(s in t){var o=t[s];e.call(i,o,s,t)&&r.push(o)}return r}),t.isArray=function(e){return"function"==typeof e?e:function(e){return e?Object.prototype.toString.call(e)==="[object Array]":!1}}(Array.isArray),t.seq=function(t,n,r,i){var s,o;if("number"!=typeof t)return!1;if(t===Infinity)return!1;if("number"!=typeof n)return!1;if(n===Infinity)return!1;if(r===0)return!1;if(!e.inArray(typeof r,["undefined","number"]))return!1;if(t===n)return i?[i(t)]:[t];r=r||1,i=i||function(e){return e},s=t,o=[];if(t<n)while(s<=n)o.push(i(s)),s+=r;else while(s>=n)o.push(i(s)),s-=r;return o},t.each=function(e,t,n){var r,i;if("object"!=typeof e)throw new TypeError("ARRAY.each: array must be object. Found: "+e);if("function"!=typeof t)throw new TypeError("ARRAY.each: cb must be function. Found: "+t);n=n||this,i=e.length;for(r=0;r<i;r++)t.call(n,e[r],r)},t.map=function(){var n,r,i,s,o,u,a;u=arguments[0],a=arguments[1];if(!t.isArray(u)){e.log("ARRAY.map: first parameter must be array. Found: "+u);return}if("function"!=typeof a){e.log("ARRAY.map: second parameter must be function. Found: "+a);return}r=arguments.length;if(r===3)i=[null,arguments[2]];else if(r===4)i=[null,arguments[2],arguments[3]];else{r-=1,i=new Array(r);for(n=1;n<r;n++)i[n]=arguments[n+1]}s=[],r=u.length;for(n=0;n<r;n++)i[0]=u[n],o=a.apply(this,i),"undefined"!=typeof o&&s.push(o);return s},t.removeElement=function(t,n){var r,i;if("undefined"==typeof t||!n)return!1;"object"==typeof t?r=e.equals:r=function(e,t){return e===t};for(i=0;i<n.length;i++)if(r(t,n[i]))return n.splice(i,1);return!1},t.inArray=function(t,n){var r,i,s;if(!n)return!1;r=e.equals,s=n.length;for(i=0;i<s;i++)if(r.call(this,t,n[i]))return!0;return!1},t.in_array=function(e,n){return console.log("***ARRAY.in_array is deprecated. Use ARRAY.inArray instead.***"),t.inArray(e,n)},t.getNGroups=function(e,n){return t.getGroupsSizeN(e,Math.floor(e.length/n))},t.getGroupsSizeN=function(e,t){var n=e.slice(0),r=n.length,i=n.length,s=[],o,u,a=[],f=0;for(o=0;o<i;o++)u=Math.floor(Math.random()*r),f>=t&&(s.push(a),f=0,a=[]),a.push(n[u]),n.splice(u,1),r=n.length,f++;return a.length>0&&s.push(a),s},t._latinSquare=function(t,n,r){r="undefined"==typeof r?!0:r;if(t===n&&!r)return!1;var i=[],s=[];for(var o=0;o<t;o++)i[o]=o;var u=null,a=0,f=t,l=[];r||(f=t-1);for(o=0;o<n;o++){do u=e.randomInt(a,f);while(e.inArray(u,l));l.push(u),u==1?(s[o]=i.slice(u),s[o].push(0)):s[o]=i.slice(u).concat(i.slice(0,u))}return s},t.latinSquare=function(e,n){return n||(n=e),!e||e<0||n<0?!1:(n>e&&(n=e),t._latinSquare(e,n,!0))},t.latinSquareNoSelf=function(e,n){return n||(n=e-1),!e||e<0||n<0?!1:(n>e&&(n=e-1),t._latinSquare(e,n,!1))},t.generateCombinations=function n(e,t){var r,i,s,o,u;s=[];for(r=0;r<e.length;r++)if(t===1)s.push([e[r]]);else{o=n(e.slice(r+1,e.length),t-1);for(i=0;i<o.length;i++)u=o[i],u.unshift(e[r]),s.push(u)}return s},t.matchN=function(e,n,r){var i,s,o,u,a,f;if(!e)return;if(!n)return e;i=[],a=e.length,f=[];for(s=0;s<a;s++)o=e.slice(0),o.splice(s,1),r&&(o=t.arrayDiff(o,f)),u=t.getNRandom(o,n),f=f.concat(u),u.splice(0,0,e[s]),i.push(u),u=[];return i},t.rep=function(n,r){var i,s;t.isArray(n)||(n=[n]);if(!r)return n.slice(0);if(r<1){e.log("times must be greater or equal 1","ERR");return}i=1,s=n.slice(0);for(;i<r;i++)s=s.concat(n);return s},t.stretch=function(n,r){var i,s,o,u;if(!n)return;if(!r)return n.slice(0);if("number"==typeof r){if(r<1){e.log("times must be greater or equal 1","ERR");return}r=t.rep([r],n.length)}i=[];for(s=0;s<n.length;s++){o=r[s%r.length];for(u=0;u<o;u++)i.push(n[s])}return i},t.arrayIntersect=function(t,n){return t.filter(function(t){return e.inArray(t,n)})},t.arrayDiff=function(t,n){return t.filter(function(t){return!e.inArray(t,n)})},t.shuffle=function(e){var t,n,r,i,s;if(!e)return;t=Array.prototype.slice.call(e),n=e.length-1;for(s=n;s>0;s--)r=Math.floor(Math.random()*(s+1)),i=t[r],t[r]=t[s],t[s]=i;return t},t.getNRandom=function(e,n){return t.shuffle(e).slice(0,n)},t.distinct=function(e){var n=[];return e?(t.each(e,function(e){t.inArray(e,n)||n.push(e)}),n):n},t.transpose=function(e){if(!e)return;var n,r,i,s,o=[];n=e.length||0,r=t.isArray(e[0])?e[0].length:0;if(n===0||r===0)return o;for(i=0;i<r;i++){o[i]=[];for(s=0;s<n;s++)o[i][s]=e[s][i]}return o},e.extend(t)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(JSUS){"use strict";function COMPATIBILITY(){}COMPATIBILITY.compatibility=function(){var support={};try{Object.defineProperty({},"a",{enumerable:!1,value:1}),support.defineProperty=!0}catch(e){support.defineProperty=!1}try{eval("({ get x(){ return 1 } }).x === 1"),support.setter=!0}catch(err){support.setter=!1}try{var value;eval("({ set x(v){ value = v; } }).x = 1"),support.getter=!0}catch(err){support.getter=!1}return support},JSUS.extend(COMPATIBILITY)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function r(){}var t,n;r.get=function(e,t){var n;return n=document.createElement(e),"string"==typeof t?n.id=t:t&&this.addAttributes(n,t),e==="iframe"&&n.id&&!n.name&&(n.name=n.id),n},r.add=r.append=function(e,t,n){var i;i=this.get(e,n);if(n&&n.insertBefore){if(n.insertAfter)throw new Error("DOM.add: options.insertBefore and options.insertBefore cannot be both set.");if(!t.parentNode)throw new Error("DOM.add: root.parentNode not found. Cannot insert before.");t.parentNode.insertBefore(i,t)}else if(n&&n.insertAfter){if(!t.parentNode)throw new Error("DOM.add: root.parentNode not found. Cannot insert after.");r.insertAfter(i,t)}else t.appendChild(i);return i},r.addAttributes=function(e,t){var n;if(!r.isElement(e))throw new TypeError("DOM.addAttributes: elem must be HTMLElement. Found: "+e);if("undefined"==typeof t)return e;if("object"!=typeof t)throw new TypeError("DOM.addAttributes: attributes must be object or undefined. Found: "+t);for(n in t)t.hasOwnProperty(n)&&(n==="id"||n==="innerHTML"?e[n]=t[n]:n==="class"||n==="className"?r.addClass(e,t[n]):n==="style"?r.style(e,t[n]):n!=="insertBefore"&&n!=="insertAfter"&&e.setAttribute(n,t[n]));return e},r.write=function(t,n){var r;if("undefined"==typeof n||n===null)n="";return e.isNode(n)||e.isElement(n)?r=n:r=document.createTextNode(n),t.appendChild(r),r},r.writeln=function(e,t,n){var i;return i=r.write(e,t),this.add(n||"br",e),i},r.sprintf=function(t,n,i){var s,o,u,a,f,l,c,h,p;i=i||document.createElement("span"),c={},n=n||{},n["%strong"]="",n["%em"]="";for(h in n)if(n.hasOwnProperty(h))switch(h.charAt(0)){case"%":u=t.indexOf(h);if(u===-1)continue;f=u+h.length,a=t.indexOf(h,f);if(a===-1){e.log("Error. Could not find closing key: "+h);continue}c[u]=h;break;case"@":t=t.replace(h,escape(n[h]));break;case"!":t=t.replace(h,n[h]);break;default:e.log("Identifier not in [!,@,%]: "+h[0])}if(!e.size(c))return i.appendChild(document.createTextNode(t));l=e.keys(c).sort(function(e,t){return e-t}),a=0;for(p=0;p<l.length;p++)h=c[l[p]],u=t.indexOf(h),a!==u-1&&i.appendChild(document.createTextNode(t.substring(a,u))),f=u+h.length,a=t.indexOf(h,f),h==="%strong"?o=document.createElement("strong"):h==="%em"?o=document.createElement("em"):o=r.get("span",n[h]),s=t.substring(f,a),o.appendChild(document.createTextNode(s)),i.appendChild(o),a+=h.length;return a!==t.length&&i.appendChild(document.createTextNode(t.substring(a))),i},r.isNode=function(e){return!e||"object"!=typeof e?!1:"object"==typeof Node?e instanceof Node:"number"==typeof e.nodeType&&"string"==typeof e.nodeName},r.isElement=function(e){return e&&"object"==typeof e&&e.nodeType===1&&"string"==typeof e.nodeName},r.shuffleElements=function(t,n,r){var i,s,o,u,a,f,l;if(!e.isNode(t))throw new TypeError("DOM.shuffleElements: parent must be a node. Found: "+t);if(!t.children||!t.children.length)return e.log("DOM.shuffleElements: parent has no children.","ERR"),!1;if(n)if("undefined"==typeof r&&"function"==typeof n)r=n;else{if(!e.isArray(n))throw new TypeError("DOM.shuffleElements: order must be array. Found: "+n);if(n.length!==t.children.length)throw new Error("DOM.shuffleElements: order length must match the number of children nodes.")}if(r&&"function"!=typeof r)throw new TypeError("DOM.shuffleElements: order must be array. Found: "+n);a=t.children;if("undefined"==typeof a){f=this.firstChild;while(f)f.nodeType==1&&a.push(f),f=f.nextSibling}s=a.length,u=new Array(s),r&&(o=new Array(s)),n||(n=e.sample(0,s-1));for(i=0;i<s;i++){l=a[n[i]].id;if("string"!=typeof l||l==="")throw new Error("DOM.shuffleElements: no id found on child n. "+n[i]);u[i]=l,r&&(o[i]=n[i])}for(i=0;i<s;i++)t.appendChild(a[u[i]]),r&&r(a[u[i]],i,o[i]);return u},r.populateSelect=function(e,t){var n,i;if(!r.isElement(e))throw new TypeError("DOM.populateSelect: select must be HTMLElement. Found: "+e);if(t){if("object"!=typeof t)throw new TypeError("DOM.populateSelect: options must be object or undefined. Found: "+t);for(n in t)t.hasOwnProperty(n)&&(i=document.createElement("option"),i.value=n,i.innerHTML=t[n],e.appendChild(i))}return e},r.removeChildrenFromNode=function(e){while(e.hasChildNodes())e.removeChild(e.firstChild)},r.insertAfter=function(e,t){return t.insertBefore(e,t.nextSibling)},r.addCSS=function(t,n,r){if("string"!=typeof t||t.trim()==="")throw new TypeError("DOM.addCSS: cssPath must be a non-empty string. Found: "+t);n=n||document.head||document.body||document;if(!n)throw new Error("DOM.addCSS: root is undefined, and could not detect a valid root for css: "+t);return r=e.mixin({rel:"stylesheet",type:"text/css",href:t},r),this.add("link",n,r)},r.addJS=function(t,n,r){if("string"!=typeof t||t.trim()==="")throw new TypeError("DOM.addCSS: jsPath must be a non-empty string. Found: "+t);n=n||document.head||document.body||document;if(!n)throw new Error("DOM.addCSS: root is undefined, and could not detect a valid root for css: "+t);return r=e.mixin({charset:"utf-8",type:"text/javascript",src:t},r),this.add("script",n,r)},r.highlight=function(e,t){var n;switch(t){case"OK":n="green";break;case"WARN":n="yellow";break;case"ERR":n="red";break;default:t.charAt(0)==="#"?n=t:n="red"}return this.addBorder(e,n)},r.addBorder=function(e,t,n,i){var s;return t=t||"red",n=n||"5px",i=i||"solid",s={border:n+" "+i+" "+t},r.style(e,s)},r.style=function(e,t){var n;if(!r.isElement(e))throw new TypeError("DOM.style: elem must be HTMLElement. Found: "+e);if(t){if("object"!=typeof t)throw new TypeError("DOM.style: properties must be object or undefined. Found: "+t);for(n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])}return e},r.generateUniqueId=function(){function n(e,t){var n,r;r=e.length;if(r===1)return!e[0].document.getElementById(t);if(r===2)return!!e[0].document.getElementById(t)&&!!e[1].document.getElementById(t);n=-1;for(;++n<r;)if(e[n].document.getElementById(t))return!1;return!0}var t;return t=100,function(r,i){var s,o,u,a;if(r){if("string"!=typeof r&&"number"!=typeof r)throw new TypeError("DOM.generateUniqueId: prefix must be string or number. Found: "+r)}else r=e.randomString(8,"a");s=r+"_",o=[window],(i||"undefined"==typeof i)&&window.frames&&(o=o.concat(window.frames)),u=!0,a=-1;while(u){s=r+"_"+e.randomInt(1e3),u=n(o,s);if(++a>t)throw new Error("DOM.generateUniqueId: could not find unique id within "+t+" trials.")}return s}}(),r.removeClass=function(e,t,n){var i,s;if(!n&&!r.isElement(e))throw new TypeError("DOM.removeClass: elem must be HTMLElement. Found: "+e);if(t){if("string"!=typeof t||t.trim()==="")throw new TypeError("DOM.removeClass: className must be HTMLElement. Found: "+t);i=new RegExp("(?:^|\\s)"+t+"(?!\\S)"),s=e.className=e.className.replace(i,"")}return e},r.addClass=function(e,t,n){if(!n&&!r.isElement(e))throw new TypeError("DOM.addClass: elem must be HTMLElement. Found: "+e);if(t){t instanceof Array&&(t=t.join(" "));if("string"!=typeof t||t.trim()==="")throw new TypeError("DOM.addClass: className must be HTMLElement. Found: "+t);e.className?e.className+=" "+t:e.className=t}return e},r.getElementsByClassName=function(e,t,n){var r,i,s,o,u,a;r=[],s=n||"*";if(e.evaluate){o="//"+s+'[contains(concat(" ", normalize-space(@class), " "), "'+t+' ")]',o=e.evaluate(o,e,null,0,null);while(i=o.iterateNext())r.push(i)}else{a=new RegExp("(^| )"+t+"( |$)"),o=e.getElementsByTagName(s);for(u=0;u<o.length;u++)a.test((i=o[u]).className)&&r.push(o[u])}return r},r.getIFrameDocument=function(e){return e?e.contentDocument||e.contentWindow?e.contentWindow.document:null:null},r.getIFrameAnyChild=function(e){var t;if(!e)return;return t=r.getIFrameDocument(e),t.head||t.body||t.lastChild||t.getElementsByTagName("html")[0]},r.addEvent=function(e,t,n,r){return r=!!r,e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,r)},r.removeEvent=function(e,t,n,r){return r=!!r,e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,r)},r.onFocusIn=function(e,n){var r;if("function"!=typeof e&&null!==e)throw new TypeError("JSUS.onFocusIn: cb must be function or null.");if(n){if("object"!=typeof n&&"function"!=typeof n)throw new TypeError("JSUS.onFocusIn: ctx must be object, function or undefined.");r=e,e=function(){r.call(n)}}t(e)},r.onFocusOut=function(e,n){var r;if("function"!=typeof e&&null!==e)throw new TypeError("JSUS.onFocusOut: cb must be function or null.");if(n){if("object"!=typeof n&&"function"!=typeof n)throw new TypeError("JSUS.onFocusIn: ctx must be object, function or undefined.");r=e,e=function(){r.call(n)}}t(undefined,e)},r.disableRightClick=function(e){e=e||document,e.layers?(e.captureEvents(Event.MOUSEDOWN),e.onmousedown=function(n){if(e.layers||e.getElementById&&!e.all)if(n.which==2||n.which==3)return!1}):e.all&&!e.getElementById&&(e.onmousedown=function(){if(event.button==2)return!1}),e.oncontextmenu=function(){return!1}},r.enableRightClick=function(e){e=e||document,e.layers?(e.releaseEvents(Event.MOUSEDOWN),e.onmousedown=null):e.all&&!e.getElementById&&(e.onmousedown=null),e.oncontextmenu=null},r.disableBackButton=function(t){return function(n){n="undefined"==typeof n?!0:n;if(n&&!t){if(!history.pushState||!history.go)return e.log("DOM.disableBackButton: method not supported by browser."),null;history.pushState(null,null,location.href),window.onpopstate=function(e){history.go(1)}}else t&&(window.onpopstate=null);return t=n,n}}(!1),r.playSound="undefined"==typeof Audio?function(){console.log("JSUS.playSound: Audio tag not supported in your browser. Cannot play sound.")}:function(e){var t;if("string"==typeof e)t=new Audio(e);else{if("object"!=typeof e||"function"!=typeof e.play)throw new TypeError("JSUS.playSound: sound must be string or audio element.");t=e}t.play()},r.blinkTitle=function(r){var i,s,o;return i=function(e){clearInterval(r),r=null,o&&(o.removeEventListener("click",i),o=null),s&&(document.title=s,s=null)},function(u,a){var f,l,c,h,p;null!==r&&i();if("undefined"==typeof u)return null;l="JSUS.blinkTitle: ",a=a||{};if("undefined"==typeof a.finalTitle)s=document.title;else{if("string"!=typeof a.finalTitle)throw new TypeError(l+"options.finalTitle must be "+"string or undefined. Found: "+a.finalTitle);s=a.finalTitle}if("undefined"!=typeof a.repeatFor){p=e.isInt(a.repeatFor,0);if(!1===p)throw new TypeError(l+"options.repeatFor must be "+"a positive integer. Found: "+a.repeatFor)}a.stopOnFocus&&e.onFocusIn(function(){i(),t(null,null)});if("undefined"!=typeof a.stopOnClick){if("object"!=typeof a.stopOnClick||!a.stopOnClick.addEventListener)throw new TypeError(l+"options.stopOnClick must be "+"an HTML element with method "+"addEventListener. Found: "+a.stopOnClick);o=a.stopOnClick,o.addEventListener("click",i)}if(a.startOnBlur)return a.startOnBlur=null,e.onFocusOut(function(){e.blinkTitle(u,a)}),null;if("string"==typeof u)u=[u,"!!!"];else if(!e.isArray(u))throw new TypeError(l+"titles must be string, "+"array of strings or undefined. Found: "+u);return h=0,f=a.period||1e3,c=function(){n(u[h]),h=(h+1)%u.length,"number"==typeof p&&h===0&&(p--,p===0&&i())},c(),r=setInterval(c,f),i}}(null),r.cookieSupport=function(){var e,t;t=!0;do{e="gCStest="+Math.floor(Math.random()*1e8),document.cookie=t?e+";expires=Tue, 01-Jan-2030 00:00:00 GMT":e;if(document.cookie.indexOf(e)!==-1)return document.cookie=e+";expires=Sat, 01-Jan-2000 00:00:00 GMT",t}while(!(t=!t));return null},r.viewportSize=function(e){var t,n,r,i,s,o;if(e&&e!=="x"&&e!=="y")throw new TypeError('DOM.viewportSize: dim must be "x","y" or undefined. Found: '+e);return t=window,n=document,r=n.documentElement,i=n.getElementsByTagName("body")[0],s=t.innerWidth||r.clientWidth||i.clientWidth,o=t.innerHeight||r.clientHeight||i.clientHeight,e?e==="x"?s:o:{x:s,y:o}},r.makeTabbable=function(e,t){return t=t||{},e.setAttribute("tabindex",t.index||0),t.clicklable&&r.makeClickable(e),e},r.makeClickable=function(){function e(e){if(e.keyCode===32||e.keyCode===13)e.preventDefault(),e.target.click()}var t;return t=function(t,n){return"undefined"==typeof n&&(n=!0),n?t.addEventListener("keydown",e):t.removeEventListener("keydown",e),t},t.cb=e,t}(),t=function(t){function u(e){var t;e=e||window.event,e.type in o?t=o[e.type]:t=this[s]?!0:!1,t?r&&r():n&&n()}var n,r,i,s,o;return t?("hidden"in t?(s="hidden",i="visibilitychange"):"mozHidden"in t?(s="mozHidden",i="mozvisibilitychange"):"webkitHidden"in t?(s="webkitHidden",i="webkitvisibilitychange"):"msHidden"in t&&(s="msHidden",i="msvisibilitychange"),o={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1},function(e,s){var o;"undefined"!=typeof e?n=e:r=s,o=!n&&!r?null:u,i?o?t.addEventListener(i,u):t.removeEventListener(i,u):"onfocusin"in t?t.onfocusin=t.onfocusout=o:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=o}):function(){e.log("onFocusChange: no document detected.");return}}("undefined"!=typeof document?document:null),n=function(e){if("string"!=typeof e)throw new TypeError("JSUS.changeTitle: title must be string. Found: "+e);document.title=e},e.extend(r)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function r(){}var t,n;r.write=function(t,n){var r;if("undefined"==typeof n||n===null)n="";return e.isNode(n)||e.isElement(n)?r=n:r=document.createTextNode(n),t.appendChild(r),r},r.writeln=function(e,t,n){var i;return i=r.write(e,t),this.addBreak(e,n),i},r.sprintf=function(t,n,r){var i,s,o,u,a,f,l,c,h;r=r||document.createElement("span"),l={},n=n||{},n["%strong"]="",n["%em"]="";for(c in n)if(n.hasOwnProperty(c))switch(c.charAt(0)){case"%":o=t.indexOf(c);if(o===-1)continue;a=o+c.length,u=t.indexOf(c,a);if(u===-1){e.log("Error. Could not find closing key: "+c);continue}l[o]=c;break;case"@":t=t.replace(c,escape(n[c]));break;case"!":t=t.replace(c,n[c]);break;default:e.log("Identifier not in [!,@,%]: "+c[0])}if(!e.size(l))return r.appendChild(document.createTextNode(t));f=e.keys(l).sort(function(e,t){return e-t}),u=0;for(h=0;h<f.length;h++)c=l[f[h]],o=t.indexOf(c),u!==o-1&&r.appendChild(document.createTextNode(t.substring(u,o))),a=o+c.length,u=t.indexOf(c,a),c==="%strong"?s=document.createElement("strong"):c==="%em"?s=document.createElement("em"):s=e.getElement("span",null,n[c]),i=t.substring(a,u),s.appendChild(document.createTextNode(i)),r.appendChild(s),u+=c.length;return u!==t.length&&r.appendChild(document.createTextNode(t.substring(u))),r},r.isNode=function(e){return!e||"object"!=typeof e?!1:"object"==typeof Node?e instanceof Node:"number"==typeof e.nodeType&&"string"==typeof e.nodeName},r.isElement=function(e){return e&&"object"==typeof e&&e.nodeType===1&&"string"==typeof e.nodeName},r.shuffleElements=function(t,n){var r,i,s,o,u,a,f,l;if(!e.isNode(t))throw new TypeError("DOM.shuffleElements: parent must be a node. Found: "+t);if(!t.children||!t.children.length)return e.log("DOM.shuffleElements: parent has no children.","ERR"),!1;if(n){if(!e.isArray(n))throw new TypeError("DOM.shuffleElements: order must array.Found: "+n);if(n.length!==t.children.length)throw new Error("DOM.shuffleElements: order length must match the number of children nodes.")}o=t.children;if("undefined"==typeof o){u=this.firstChild;while(u)u.nodeType==1&&o.push(u),u=u.nextSibling}i=o.length,s=new Array(i),n||(n=e.sample(0,i-1));for(r=0;r<i;r++){a=o[n[r]].id;if("string"!=typeof a||a==="")throw new Error("DOM.shuffleElements: no id found on child n. "+n[r]+".");s[r]=a}for(r=0;r<i;r++)t.appendChild(o[s[r]]);return s},r.shuffleNodes=function(e,t){return console.log("***DOM.shuffleNodes is deprecated. Use Dom.shuffleElements instead.***"),r.shuffleElements(e,t)},r.getElement=function(e,t,n){var r=document.createElement(e);return"undefined"!=typeof t&&(r.id=t),this.addAttributes2Elem(r,n)},r.addElement=function(e,t,n,r){var i=this.getElement(e,n,r);return t.appendChild(i)},r.addAttributes2Elem=function(t,n){var i;if(!t||!n)return t;if("object"!=typeof n)return t;for(i in n)n.hasOwnProperty(i)&&(i==="id"?t.id=n[i]:i==="class"||i==="className"?r.addClass(t,n[i]):i==="style"?r.style(t,n[i]):i==="label"?e.log("DOM.addAttributes2Elem: label attribute is not supported. Use DOM.addLabel instead."):t.setAttribute(i,n[i]));return t},r.populateSelect=function(e,t){var n,r;if(!e||!t)return;for(n in t)t.hasOwnProperty(n)&&(r=document.createElement("option"),r.value=t[n],r.appendChild(document.createTextNode(n)),e.appendChild(r))},r.removeChildrenFromNode=function(e){while(e.hasChildNodes())e.removeChild(e.firstChild)},r.insertAfter=function(e,t){t.insertBefore(e,t.nextSibling)},r.generateUniqueId=function(t){function r(t){var r=!0;while(r)for(var i=0;i<n.length;i++){r=n[i].document.getElementById(t);if(r){t=""+t+"_"+e.randomInt(0,1e3);break}}return t}var n=[window];return window.frames&&(n=n.concat(window.frames)),r(t+"_"+e.randomInt(0,1e7))},r.getButton=function(e,t,n){var r;return r=document.createElement("button"),"undefined"!=typeof e&&(r.id=e),r.appendChild(document.createTextNode(t||"Send")),this.addAttributes2Elem(r,n)},r.addButton=function(e,t,n,r){var i=this.getButton(t,n,r);return e.appendChild(i)},r.getFieldset=function(e,t,n){var r=this.getElement("fieldset",e,n),i=document.createElement("Legend");return i.appendChild(document.createTextNode(t)),r.appendChild(i),r},r.addFieldset=function(e,t,n,r){var i=this.getFieldset(t,n,r);return e.appendChild(i)},r.getTextInput=function(e,t){var n=document.createElement("input");return"undefined"!=typeof e&&(n.id=e),n.setAttribute("type","text"),this.addAttributes2Elem(n,t)},r.addTextInput=function(e,t,n){var r=this.getTextInput(t,n);return e.appendChild(r)},r.getTextArea=function(e,t){var n=document.createElement("textarea");return"undefined"!=typeof e&&(n.id=e),this.addAttributes2Elem(n,t)},r.addTextArea=function(e,t,n){var r=this.getTextArea(t,n);return e.appendChild(r)},r.getCanvas=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");return r?(n.id=e,this.addAttributes2Elem(n,t)):(alert("Canvas is not supported"),!1)},r.addCanvas=function(e,t,n){var r=this.getCanvas(t,n);return e.appendChild(r)},r.getSlider=function(e,t){var n=document.createElement("input");return n.id=e,n.setAttribute("type","range"),this.addAttributes2Elem(n,t)},r.addSlider=function(e,t,n){var r=this.getSlider(t,n);return e.appendChild(r)},r.getRadioButton=function(e,t){var n=document.createElement("input");return n.id=e,n.setAttribute("type","radio"),this.addAttributes2Elem(n,t)},r.addRadioButton=function(e,t,n){var r=this.getRadioButton(t,n);return e.appendChild(r)},r.getLabel=function(e,t,n,r){if(!e)return!1;var i=document.createElement("label");return i.id=t,i.appendChild(document.createTextNode(n)),"undefined"==typeof e.id&&(e.id=this.generateUniqueId()),i.setAttribute("for",e.id),this.addAttributes2Elem(i,r),i},r.addLabel=function(e,t,n,r,i){if(!e||!t||!r)return!1;var s=this.getLabel(t,n,r,i);return e.insertBefore(s,t),s},r.getSelect=function(e,t){return this.getElement("select",e,t)},r.addSelect=function(e,t,n){return this.addElement("select",e,t,n)},r.getIFrame=function(e,t){return t=t||{},t.name||(t.name=e),this.getElement("iframe",e,t)},r.addIFrame=function(e,t,n){var r=this.getIFrame(t,n);return e.appendChild(r)},r.addBreak=function(e,t){var n=t||"br",r=document.createElement(n);return e.appendChild(r)},r.getDiv=function(e,t){return this.getElement("div",e,t)},r.addDiv=function(e,t,n){return this.addElement("div",e,t,n)},r.addCSS=function(t,n,r,i){return t=t||document.head||document.body||document,t?(i=i||{},i=e.merge(i,{rel:"stylesheet",type:"text/css",href:n}),this.addElement("link",t,r,i)):!1},r.addJS=function(t,n,r,i){return t=t||document.head||document.body||document,t?(i=i||{},i=e.merge(i,{charset:"utf-8",type:"text/javascript",src:n}),this.addElement("script",t,r,i)):!1},r.highlight=function(e,t){var n;if(!e)return;switch(t){case"OK":n="green";break;case"WARN":n="yellow";break;case"ERR":n="red";break;default:t.charAt(0)==="#"?n=t:n="red"}return this.addBorder(e,n)},r.addBorder=function(e,t,n,i){var s;if(!e)return;return t=t||"red",n=n||"5px",i=i||"solid",s={border:n+" "+i+" "+t},r.style(e,s)},r.style=function(e,t){var n;if(!e||!t)return;if(!r.isElement(e))return;for(n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n]);return e},r.removeClass=function(e,t){var n,r;if(!e||!t)return;return n=new RegExp("(?:^|\\s)"+t+"(?!\\S)"),r=e.className=e.className.replace(n,""),e},r.addClass=function(e,t){if(!e)return;if(t instanceof Array)t=t.join(" ");else if("string"!=typeof t)return;return!e.className||e.className===""?e.className=t:e.className+=" "+t,e},r.getElementsByClassName=function(e,t,n){var r,i,s,o,u,a;r=[],s=n||"*";if(e.evaluate){o="//"+s+'[contains(concat(" ", normalize-space(@class), " "), "'+t+' ")]',o=e.evaluate(o,e,null,0,null);while(i=o.iterateNext())r.push(i)}else{a=new RegExp("(^| )"+t+"( |$)"),o=e.getElementsByTagName(s);for(u=0;u<o.length;u++)a.test((i=o[u]).className)&&r.push(o[u])}return r},r.getIFrameDocument=function(e){return e?e.contentDocument||e.contentWindow?e.contentWindow.document:null:null},r.getIFrameAnyChild=function(e){var t;if(!e)return;return t=W.getIFrameDocument(e),t.head||t.body||t.lastChild||t.getElementsByTagName("html")[0]},r.disableRightClick=function(e){e=e||document,e.layers?(e.captureEvents(Event.MOUSEDOWN),e.onmousedown=function(n){if(e.layers||e.getElementById&&!e.all)if(n.which==2||n.which==3)return!1}):e.all&&!e.getElementById&&(e.onmousedown=function(){if(event.button==2)return!1}),e.oncontextmenu=new Function("return false")},r.enableRightClick=function(e){e=e||document,e.layers?(e.releaseEvents(Event.MOUSEDOWN),e.onmousedown=null):e.all&&!e.getElementById&&(e.onmousedown=null),e.oncontextmenu=null},r.addEvent=function(e,t,n,r){return r=!!r,e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,r)},r.removeEvent=function(e,t,n,r){return r=!!r,e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,r)},r.disableBackButton=function(e){return function(t){t="undefined"==typeof t?!0:t;if(t&&!e){if(!history.pushState||!history.go)return node.warn("DOM.disableBackButton: method not supported by browser."),null;history.pushState(null,null,location.href),window.onpopstate=function(e){history.go(1)}}else e&&(window.onpopstate=null);return e=t,t}}(!1),r.playSound="undefined"==typeof Audio?function(){console.log("JSUS.playSound: Audio tag not supported in your browser. Cannot play sound.")}:function(e){var t;if("string"==typeof e)t=new Audio(e);else{if("object"!=typeof e||"function"!=typeof e.play)throw new TypeError("JSUS.playSound: sound must be string or audio element.");t=e}t.play()},r.onFocusIn=function(e,n){var r;if("function"!=typeof e&&null!==e)throw new TypeError("JSUS.onFocusIn: cb must be function or null.");if(n){if("object"!=typeof n&&"function"!=typeof n)throw new TypeError("JSUS.onFocusIn: ctx must be object, function or undefined.");r=e,e=function(){r.call(n)}}t(e)},r.onFocusOut=function(e,n){var r;if("function"!=typeof e&&null!==e)throw new TypeError("JSUS.onFocusOut: cb must be function or null.");if(n){if("object"!=typeof n&&"function"!=typeof n)throw new TypeError("JSUS.onFocusIn: ctx must be object, function or undefined.");r=e,e=function(){r.call(n)}}t(undefined,e)},r.blinkTitle=function(r){var i,s,o;return i=function(e){clearInterval(r),r=null,o&&(o.removeEventListener("click",i),o=null),s&&(document.title=s,s=null)},function(u,a){var f,l,c,h,p;null!==r&&i();if("undefined"==typeof u)return null;l="JSUS.blinkTitle: ",a=a||{};if("undefined"==typeof a.finalTitle)s=document.title;else{if("string"!=typeof a.finalTitle)throw new TypeError(l+"options.finalTitle must be "+"string or undefined. Found: "+a.finalTitle);s=a.finalTitle}if("undefined"!=typeof a.repeatFor){p=e.isInt(a.repeatFor,0);if(!1===p)throw new TypeError(l+"options.repeatFor must be "+"a positive integer. Found: "+a.repeatFor)}a.stopOnFocus&&e.onFocusIn(function(){i(),t(null,null)});if("undefined"!=typeof a.stopOnClick){if("object"!=typeof a.stopOnClick||!a.stopOnClick.addEventListener)throw new TypeError(l+"options.stopOnClick must be "+"an HTML element with method "+"addEventListener. Found: "+a.stopOnClick);o=a.stopOnClick,o.addEventListener("click",i)}if(a.startOnBlur)return a.startOnBlur=null,e.onFocusOut(function(){e.blinkTitle(u,a)}),null;if("string"==typeof u)u=[u,"!!!"];else if(!e.isArray(u))throw new TypeError(l+"titles must be string, "+"array of strings or undefined.");return h=0,f=a.period||1e3,c=function(){n(u[h]),h=(h+1)%u.length,"number"==typeof p&&h===0&&(p--,p===0&&i())},c(),r=setInterval(c,f),i}}(null),r.cookieSupport=function(){var e,t;t=!0;do{e="gCStest="+Math.floor(Math.random()*1e8),document.cookie=t?e+";expires=Tue, 01-Jan-2030 00:00:00 GMT":e;if(document.cookie.indexOf(e)!==-1)return document.cookie=e+";expires=Sat, 01-Jan-2000 00:00:00 GMT",t}while(!(t=!t));return null},r.viewportSize=function(e){var t,n,r,i,s,o;if(e&&e!=="x"&&e!=="y")throw new TypeError('DOM.viewportSize: dim must be "x","y" or undefined. Found: '+e);return t=window,n=document,r=n.documentElement,i=n.getElementsByTagName("body")[0],s=t.innerWidth||r.clientWidth||i.clientWidth,o=t.innerHeight||r.clientHeight||i.clientHeight,e?e==="x"?s:o:{x:s,y:o}},t=function(t){function u(e){var t;e=e||window.event,e.type in o?t=o[e.type]:t=this[s]?!0:!1,t?r&&r():n&&n()}var n,r,i,s,o;return t?("hidden"in t?(s="hidden",i="visibilitychange"):"mozHidden"in t?(s="mozHidden",i="mozvisibilitychange"):"webkitHidden"in t?(s="webkitHidden",i="webkitvisibilitychange"):"msHidden"in t&&(s="msHidden",i="msvisibilitychange"),o={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1},function(e,s){var o;"undefined"!=typeof e?n=e:r=s,o=!n&&!r?null:u,i?o?t.addEventListener(i,u):t.removeEventListener(i,u):"onfocusin"in t?t.onfocusin=t.onfocusout=o:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=o}):function(){e.log("onFocusChange: no document detected.");return}}("undefined"!=typeof document?document:null),n=function(e){if("string"!=typeof e)throw new TypeError("JSUS.changeTitle: title must be string. Found: "+e);document.title=e},e.extend(r)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(JSUS){"use strict";function EVAL(){}EVAL.eval=function(str,context){var func;if(!str)return;return context=context||this,func=function(str){return str="("+str+")","undefined"!=typeof window&&window.execScript?(window.execScript("__my_eval__ = "+str),__my_eval__):eval(str)},func.call(context,str)},JSUS.extend(EVAL)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function i(){}if(!e.isNodeJS())return e.log("Cannot load JSUS.FS outside of Node.JS."),!1;var t=require("resolve"),n=require("path"),r=require("fs");i.existsSync="undefined"==typeof r.existsSync?n.existsSync:r.existsSync,i.resolveModuleDir=function(e,r){var i,s;if("string"!=typeof e)throw new TypeError("FS.resolveModuleDir: module must be string. Found: "+e);if(r&&"string"!=typeof r)throw new TypeError("FS.resolveModuleDir: basedir must be string or undefined. Found: "+r);return e==="JSUS"?n.resolve(__dirname,"..")+n.sep:(i=t.sync(e,{basedir:r||__dirname}),s=i.indexOf(e)+e.length,i.substr(0,s)+n.sep)},i.deleteIfExists=function(e,t){var n;return i.existsSync(e)?(n=r.lstatSync(e),n.isDirectory()?r.rmdir(e,function(e){if(e)throw e;t&&t()}):r.unlink(e,function(e){if(e)throw e;t&&t()}),!0):!1},i.cleanDir=function(t,i,s){var o;return t?(i?o=function(e){return n.extname(e)===i}:o=function(){return!0},t[t.length]!==n.sep&&(t+=n.sep),r.readdir(t,function(n,r){var i,u;if(n){e.log(n);return}s&&(i=e.getQueue()),r.filter(o).forEach(function(n){s&&(i.add(n),u=i.getRemoveCb(n)),e.deleteIfExists(t+n,u)}),s&&i.onReady(s)}),!0):(e.log("You must specify a directory to clean."),!1)},i.copyFromDir=function(t,s,o,u){var a,f,l,c;if(!t)return e.log("You must specify a source directory."),!1;if(!s)return e.log("You must specify a destination directory."),!1;s=n.resolve(s)+n.sep,l=[t,s];for(a=0;a<2;a++){f=l[a];if(!i.existsSync(f))return console.log(f+" does not exist."),!1;c=r.lstatSync(f);if(!c.isDirectory())return console.log(f+" is not a directory."),!1}return r.readdir(t,function(r,a){var f,l,c;if(r)throw e.log(r),new Error;u&&(f=e.getQueue());for(l in a){if(o&&n.extname(a[l])!==o)continue;u&&(f.add(l),c=f.getRemoveCb(l)),i.copyFile(t+a[l],s+a[l],c)}u&&f.onReady(u)}),!0},i.copyFile=function(e,t,n){var i,s;return i=r.createReadStream(e),s=r.createWriteStream(t),i.on("end",function(){if(n)return n(null)}),i.pipe(s)},e.extend(i)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function t(){}function r(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch(r){e[t]=n}}var n=null;"undefined"!=typeof e.compatibility&&(n=e.compatibility()),t.createObj=function(){return typeof Object.create!="function"?function(){function e(){}var t=Object.prototype.hasOwnProperty;return function(n){if(typeof n!="object")throw new TypeError("Object prototype may only be an Object or null");e.prototype=n;var r=new e;e.prototype=null;if(arguments.length>1){var i=new Object(arguments[1]);for(var s in i)t.call(i,s)&&(r[s]=i[s])}return r}}():Object.create}(),t.equals=function(e,n){var r,i,s,o;r=typeof e,i=typeof n;if(r!==i)return!1;if("undefined"===r||"undefined"===i)return e===n;if(e===null||n===null)return e===n;if("number"===r&&isNaN(e)&&"number"===i&&isNaN(n))return isNaN(e)&&isNaN(n);s={number:"",string:"","boolean":""};if(r in s)return e===n;if("function"===r)return e.toString()===n.toString();for(o in e)if(e.hasOwnProperty(o)){if("undefined"==typeof n[o]&&"undefined"!=typeof e[o])return!1;if(!n[o]&&e[o])return!1;if("function"==typeof e[o]){if(e[o].toString()!==n[o].toString())return!1}else if(!t.equals(e[o],n[o]))return!1}for(o in n)if(n.hasOwnProperty(o)){if("undefined"==typeof e[o]&&"undefined"!=typeof n[o])return!1;if(!e[o]&&n[o])return!1}return!0},t.isEmpty=function(e){var t;if(!e)return!0;if("string"==typeof e)return e.trim()==="";if("number"==typeof e)return!1;if("function"==typeof e)return!1;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},t.size=t.getListSize=function(e){var t,n;if(!e)return 0;if("number"==typeof e)return 0;if("string"==typeof e)return 0;t=0;for(n in e)e.hasOwnProperty(n)&&t++;return t},t._obj2Array=function(e,n,r,i){var s,o;if("object"!=typeof e)return[e];if(r){i="undefined"!=typeof i?i:1;if(i>r)return[e];i+=1}s=[];for(o in e)e.hasOwnProperty(o)&&(n&&s.push(o),"object"==typeof e[o]?s=s.concat(t._obj2Array(e[o],n,r,i)):s.push(e[o]));return s},t.obj2Array=function(e,n){return t._obj2Array(e,!1,n)},t.obj2KeyedArray=t.obj2KeyArray=function(e,n){return t._obj2Array(e,!0,n)},t.obj2QueryString=function(e){var t,n;if("object"!=typeof e)throw new TypeError("JSUS.objectToQueryString: obj must be object.");t=[];for(n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return"?"+t.join("&")},t.keys=function(){function t(e,r,i,s,o,u,a,f,l,c,h,p,d){var v,m,g,y;m=i===r;for(v in e)if(e.hasOwnProperty(v)){g="object"==typeof e[v];if(u||a&&(m||!g)||f&&m)o?(y=s+v,p[y]||(d?n(y,c,d):c.push(y))):p[v]||(h?h[v]||(d?n(v,c,d):c.push(v),h[v]=!0):d?n(v,c,d):c.push(v));g&&i<r&&t(e[v],r,i+1,o?s+v+l:v,o,u,a,f,l,c,h,p,d)}return c}function n(t,n,r){var i;i=r(t),"string"==typeof i||"number"==typeof i?n.push(i):e.isArray(i)&&i.length?i.length<4?(n.push(i[0]),i.length>1&&(n.push(i[1]),i.length>2&&n.push(i[2]))):function(){var e=-1,t=i.length;for(;++e<t;)n.push(i[e])}(i,n):"undefined"==typeof i&&n.push(t)}return function(e,n,r){var i,s,o,u,a,f,l,c;arguments.length===2&&"object"==typeof n&&(r=n,n=r.level),r=r||{},s=r.type?r.type.toLowerCase():"all";if(s==="all")o=!0;else if(s==="leaf")u=!0;else{if(s!=="level")throw new Error("keys: unknown type option: "+s);a=!0}if(r.cb&&"function"!=typeof r.cb)throw new TypeError("JSUS.keys: options.cb must be function or undefined. Found: "+r.cb);"undefined"==typeof n?l=0:"number"==typeof n?l=n:"string"==typeof n&&(l=parseInt(n,10));if("number"!=typeof l||isNaN(l))throw new Error("JSUS.keys: level must be number, undefined or a parsable string. Found: "+n);return n<0?[]:(r.concat&&("undefined"==typeof r.separator?f=".":f=r.separator),r.parent?c=r.parent+f:c="",!r.concat&&r.distinct&&(i={}),t(e,l,0,c,r.concat,o,u,a,f,r.array||[],i,r.skip||{},r.cb))}}(),t.implode=t.implodeObj=function(e){var t,n,r;if(!e)return[];t=[];for(n in e)e.hasOwnProperty(n)&&(r={},r[n]=e[n],t.push(r));return t},t.clone=function(e){var i,s,o;if(!e)return e;if("number"==typeof e)return e;if("string"==typeof e)return e;if("boolean"==typeof e)return e;"function"==typeof e?i=function(){var t,n;t=arguments.length;if(!t)return e.call(i);if(t===1)return e.call(i,arguments[0]);if(t===2)return e.call(i,arguments[0],arguments[1]);n=new Array(t);for(s=0;s<t;s++)n[s]=arguments[s];return e.apply(i,n)}:i=Object.prototype.toString.call(e)==="[object Array]"?[]:{};for(s in e)e[s]&&"object"==typeof e[s]?o=t.clone(e[s]):o=e[s],e.hasOwnProperty(s)?i[s]=o:n&&n.defineProperty?Object.defineProperty(i,s,{value:o,writable:!0,configurable:!0}):r(i,s,o);return i},t.classClone=function(t,n){var r,i;if(n===0)return t;if(t&&"object"==typeof t){r=Object.prototype.toString.call(t)==="[object Array]"?[]:e.createObj(t.constructor.prototype);for(i in t)t.hasOwnProperty(i)&&(t[i]&&"object"==typeof t[i]?r[i]=e.classClone(t[i],n-1):r[i]=t[i]);return r}return e.clone(t)},t.join=function(e,n){var r,i;r=t.clone(e);if(!n)return r;for(i in r)r.hasOwnProperty(i)&&"undefined"!=typeof n[i]&&("object"==typeof n[i]?r[i]=t.join(r[i],n[i]):r[i]=n[i]);return r},t.merge=function(e,n){var r,i;if(!e&&!n)return!1;if(!e)return t.clone(n);if(!n)return t.clone(e);r=t.clone(e);for(i in n)n.hasOwnProperty(i)&&(n[i]&&"object"==typeof n[i]?("object"!=typeof r[i]&&(Object.prototype.toString.call(n[i])==="[object Array]"?r[i]=[]:r[i]={}),r[i]=t.merge(r[i],n[i])):r[i]=n[i]);return r},t.mixin=function(e,t){var n;if(!e&&!t)return;if(!e)return t;if(!t)return e;for(n in t)e[n]=t[n];return e},t.mixout=function(e,t){var n;if(!e&&!t)return;if(!e)return t;if(!t)return e;for(n in t)"undefined"==typeof e[n]&&(e[n]=t[n]);return e},t.mixcommon=function(e,t){var n;if(!e&&!t)return;if(!e)return t;if(!t)return e;for(n in t)"undefined"!=typeof e[n]&&(e[n]=t[n]);return e},t.mergeOnKey=function(e,n,r){var i,s;i=t.clone(e);if(!n||!r)return i;for(s in n)if(n.hasOwnProperty(s)){if(!i[s]||"object"!=typeof i[s])i[s]={};i[s][r]=n[s]}return i},t.subobj=t.subObj=function(e,n){var r,i,s;if(!e)return!1;r={};if(!n)return r;n instanceof Array||(n=[n]);for(i=0;i<n.length;i++)s=n[i],e.hasOwnProperty(s)?r[s]=e[s]:t.hasOwnNestedProperty(s,e)&&t.setNestedValue(s,t.getNestedValue(s,e),r);return r},t.skim=function(e,n){var r,i;if(!e)return!1;r=t.clone(e);if(!n)return r;n instanceof Array||(n=[n]);for(i=0;i<n.length;i++)r.hasOwnProperty(i)?delete r[i]:t.deleteNestedKey(n[i],r);return r},t.setNestedValue=function(n,r,i){var s,o;return n?(i="object"==typeof i?i:{},s=n.split("."),s.length===1?(i[n]=r,i):(o=s.shift(),i[o]=t.setNestedValue(s.join("."),r,i[o]),i)):(e.log("Cannot set value of undefined property","ERR"),!1)},t.getNestedValue=function(e,n){var r,i;if(!n)return;return r=e.split("."),r.length===1?n[e]:(i=r.shift(),t.getNestedValue(r.join("."),n[i]))},t.deleteNestedKey=function(e,n){var r,i;if(!n)return;return r=e.split("."),r.length===1?(delete n[e],!0):(i=r.shift(),"undefined"==typeof n[i]?!1:t.deleteNestedKey(r.join("."),n[i]))},t.hasOwnNestedProperty=function(e,n){var r,i;return n?(r=e.split("."),r.length===1?n.hasOwnProperty(e):(i=r.shift(),t.hasOwnNestedProperty(r.join("."),n[i]))):!1},t.split=function(){var t,n,r,i,s,o;return t=function(t,n,i){var o,u,a,f;f=e.clone(r);switch(i.length){case 0:f[s]=e.clone(t);break;case 1:f[s][i[0]]=e.clone(t);break;case 2:f[s][i[0]]={},f[s][i[0]][i[1]]=e.clone(t);break;default:o=-1,u=i.length-1,a=f[s];for(;++o<u;)a[i[o]]={},a=a[i[o]];a[i[i.length-1]]=e.clone(t)}n.push(f);return},n=function(r,s,u,a){var f,l;if(i&&u>=i)t(r,s,a);else{l=o||!e.isArray(r);for(f in r)r.hasOwnProperty(f)&&("object"==typeof r[f]&&i&&u+1<=i?n(r[f],s,u+1,l?a.concat(f):a):t(r[f],s,l?a.concat(f):a))}},function(t,u,a,f){var l;if("object"!=typeof t)throw new TypeError("JSUS.split: o must be object. Found: "+t);if("string"!=typeof u||u.trim()==="")throw new TypeError("JSUS.split: key must a non-empty string. Found: "+u);if(a&&("number"!=typeof a||a<0))throw new TypeError("JSUS.split: l must a non-negative number or undefined. Found: "+a);return r=e.clone(t),"object"!=typeof t[u]?[r]:(l=[],s=u,r[u]={},i="undefined"==typeof a?1:a,o=f,n(t[u],l,0,[]),s=undefined,r=undefined,i=undefined,o=undefined,l)}}(),t.melt=function(e,t){var n={},r=t.length;for(var i=0;i<e.length;i++)n[e[i]]=t[i%r];return n},t.uniqueKey=function(t,n,r){var i,s;if(!t){e.log("Cannot find unique name in undefined object","ERR");return}s=1,n=""+(n||Math.floor(Math.random()*1e15)),r=r||1e6,i=n;while(t[i]){i=n+s,s++;if(s>r)return}return i},t.randomKey=function(e){var t;if("object"!=typeof e)throw new TypeError("OBJ.randomKey: obj must be object. Found: "+e);return t=Object.keys(e),t[t.length*Math.random()<<0]},t.augment=function(e,n,r){var i,s;r=r||t.keys(e);for(i=0;i<r.length;i++)s=r[i],"undefined"!=typeof e[s]&&Object.prototype.toString.call(e[s])!=="[object Array]"&&(e[s]=[e[s]]),"undefined"!==n[s]&&(e[s]||(e[s]=[]),e[s].push(n[s]))},t.pairwiseWalk=function(e,t,n){var r,i;if(!e&&!t)return;if(!e)return t;if(!t)return e;i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=t.hasOwnProperty(r)?n(e[r],t[r]):n(e[r]));for(r in t)t.hasOwnProperty(r)&&"undefined"==typeof i[r]&&(i[r]=n(undefined,t[r]));return i},t.getKeyByValue=function(e,n,r){var i,s;if("object"!=typeof e)throw new TypeError("OBJ.getKeyByValue: obj must be object. Found: "+e);r&&(s=[]);for(i in e)if(e.hasOwnProperty(i)&&t.equals(n,e[i])){if(!r)return i;s.push(i)}return s},t.reverseObj=function(e,t){var n,r;if(t&&"function"!=typeof t)throw new TypeError("OBJ.reverseObj: cb must be function or undefined. Found: "+t);r={};if(!e)return r;for(n in e)e.hasOwnProperty(n)&&(t?(n=t(n,e[n]),r[n[1]]=r[n[0]]):r[e[n]]=n);return r},e.extend(t)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function t(){}function n(e){var t=function(e,t,n,r){var i=parseInt(t,10),s=parseInt(r,10);return n=="*"?i*s:i/s},n=function(e,t,n,r){var i=parseInt(t,10),s=parseInt(r,10);return n=="-"?i-s:i+s},r=function(e,t,n,r){var i=parseInt(t,10),s=parseInt(r,10);return i%s};while(e.match(/([-+]?\d+) *([*\/]) *([-+]?\d+)/g))e=e.replace(/([-+]?\d+) *([*\/]) *([-+]?\d+)/,t);while(e.match(/([-+]?\d+) *([-+]) *([-+]?\d+)/g))e=e.replace(/([-+]?\d+) *([-+]) *([-+]?\d+)/,n);while(e.match(/([-+]?\d+) *% *([-+]?\d+)/g))e=e.replace(/([-+]?\d+) *% *([-+]?\d+)/,r);return e}t.stringify_prefix="!?_",t.marker_func=t.stringify_prefix+"function",t.marker_null=t.stringify_prefix+"null",t.marker_und=t.stringify_prefix+"undefined",t.marker_nan=t.stringify_prefix+"NaN",t.marker_inf=t.stringify_prefix+"Infinity",t.marker_minus_inf=t.stringify_prefix+"-Infinity",t.getQueryString=function(e,t){var n,r;if(t&&"string"!=typeof t)throw new TypeError("JSUS.getQueryString: referer must be string or undefined. Found: "+t);return t=t||window.location.search,"undefined"==typeof e?t:(e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=n.exec(t),r===null?!1:decodeURIComponent(r[1].replace(/\+/g," ")))},t.isMobileAgent=function(e){var t;if(!e){if(!navigator)throw new Error("JSUS.isMobileAgent: agent undefined and no navigator. Are you in the browser?");e=navigator.userAgent}else if("string"!=typeof e)throw new TypeError("JSUS.isMobileAgent: agent must be undefined or string. Found: "+e);return t=new RegExp("Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile","i"),t.test(e)},t.tokenize=function(t,n,r){var i,s;if(!t)return;return!n||!n.length?[t]:(r=r||{},i="[",e.each(n,function(e){e===" "&&(e="\\s"),i+=e}),i+="]+",s=new RegExp(i),t.split(s,r.limit))},t.stringify=function(e,n){return JSON.stringify(e,function(e,n){var r=typeof n;return"function"===r?t.stringify_prefix+n.toString():"undefined"===r?t.marker_und:n===null?t.marker_null:"number"===r&&isNaN(n)?t.marker_nan:n===Number.POSITIVE_INFINITY?t.marker_inf:n===Number.NEGATIVE_INFINITY?t.marker_minus_inf:n},n)},t.stringifyAll=function(e,n){var r;if("object"==typeof e)for(r in e)e.hasOwnProperty(r)||("object"==typeof e[r]?e[r]=t.stringifyAll(e[r]):e[r]=e[r]);return t.stringify(e)},t.parse=function(){function f(e){var t;if("object"!=typeof e)return l(e);for(t in e)e.hasOwnProperty(t)&&("object"==typeof e[t]?f(e[t]):e[t]=l(e[t]));return e}function l(f){var l;l=typeof f;if(l==="string"){if(f.substring(0,n)!==t.stringify_prefix)return f;if(f.substring(0,r)===t.marker_func)return e.eval(f.substring(n));if(f.substring(0,i)===t.marker_null)return null;if(f.substring(0,s)===t.marker_und)return undefined;if(f.substring(0,o)===t.marker_nan)return NaN;if(f.substring(0,u)===t.marker_inf)return Infinity;if(f.substring(0,a)===t.marker_minus_inf)return-Infinity}return f}var n=t.stringify_prefix.length,r=t.marker_func.length,i=t.marker_null.length,s=t.marker_und.length,o=t.marker_nan.length,u=t.marker_inf.length,a=t.marker_minus_inf.length;return function(e){return f(JSON.parse(e))}}(),t.isInt=function(e,n,r,i,s){var o,u;return o=/^-?\d+$/,o.test(e)?(u=parseInt(e,10),u!==parseFloat(e)?!1:t.isNumber(u,n,r,i,s)):!1},t.isFloat=function(e,n,r,i,s){var o;return o=/^-?\d*(\.\d+)?$/,o.test(e)?e.toString().indexOf(".")===-1?!1:t.isNumber(e,n,r,i,s):!1},t.isNumber=function(e,t,n,r,i){return isNaN(e)||!isFinite(e)||e===""?!1:(e=parseFloat(e),"number"==typeof t&&(r?e<t:e<=t)?!1:"number"==typeof n&&(i?e>n:e>=n)?!1:e)},t.isEmail=function(e){var t;return"string"!=typeof e?!1:e.trim().length<5?!1:(t=e.indexOf("@"),t===-1||t===0||t===e.length-1?!1:(t=e.lastIndexOf("."),t===-1||t===e.length-1||t>t+1?!1:!0))},t.range=function(r,i){var s,o,u,a,f,l,c,h,p,d,v;a=[];if("undefined"==typeof r)return a;if("number"==typeof r)r=""+r;else if("string"!=typeof r)throw new TypeError("PARSE.range: expr must be string, number, undefined. Found: "+r);if("undefined"==typeof i)i=r;else if(e.isArray(i)){if(i.length===0)return a;f=Math.min.apply(null,i),l=Math.max.apply(null,i)}else if("object"==typeof i){if("function"!=typeof i.next)throw new TypeError("PARSE.range: available.next must be function. Found: "+i.next);if("function"!=typeof i.isFinished)throw new TypeError("PARSE.range: available.isFinished must be function. Found: "+i.isFinished);if("number"!=typeof i.begin)throw new TypeError("PARSE.range: available.begin must be number. Found: "+i.begin);if("number"!=typeof i.end)throw new TypeError("PARSE.range: available.end must be number. Found: "+i.end);f=i.begin,l=i.end}else{if("string"!=typeof i)throw new TypeError("PARSE.range: available must be string, array, object or undefined. Found: "+i);i=n(i),h=i.match(/([-+]?\d+)/g);if(h===null)throw new Error("PARSE.range: no numbers in available: "+i);c=Math.min.apply(null,h),i=t.range(i,{begin:c,end:Math.max.apply(null,h),value:c,next:function(){return this.value++},isFinished:function(){return this.value>this.end}}),f=Math.min.apply(null,i),l=Math.max.apply(null,i)}r=r.replace(/end/g,parseInt(l,10)),r=r.replace(/begin/g,parseInt(f,10)),r=n(r),r=r.replace(/([-+]?\d+\.\d+)/g,function(e,t){return parseInt(t,10)}),p=/[^ \*\d<>=!\|&\.\[\],\(\)\-\+%]/g;if(r.match(p))throw new Error("PARSE.range: invalid characters found: "+r);r=r.replace(/([^& ]) *& *([^& ])/g,"$1&&$2"),r=r.replace(/([^| ]) *\| *([^| ])/g,"$1||$2"),r=r.replace(/([-+]?\d+)/g,"(x==$1)"),r=r.replace(/% *\(x==([-+]?\d+)\)/,"!(x%$1)"),r=r.replace(/!\(x%([-+]?\d+)\) *={1,} *\(x==([-+]?\d+)\)/g,"(x%$1==$2)"),r=r.replace(/([<>]=?) *\(x==([-+]?\d+)\)/g,"(x$1$2)"),r=r.replace(/\(x==([-+]?\d+)\)\.{2,}\(x==(\+?\d+)\)\.{2,}\(x==([-+]?\d+)\)/g,"(x>=$1&&x<=$3&&!((x- $1)%$2))"),r=r.replace(/\(x==([-+]?\d+)\)\.{2,}\(x==(-\d+)\)\.{2,}\(x==([-+]?\d+)\)/g,"(x<=$1&&x>=$3&&!((x- $1)%$2))"),r=r.replace(/\(x==([-+]?\d+)\)\.{2,}\(x==([-+]?\d+)\)/g,"(x>=$1&&x<=$2)"),r=r.replace(/([(\[]) *\(x==([-+]?\d+)\) *, *\(x==([-+]?\d+)\) *([\])])/g,function(e,t,n,r,i){return"(x>"+(t=="("?"":"=")+n+"&&x<"+(i==")"?"":"=")+r+")"}),r=r.replace("*",1),r=r.replace(/\s/g,""),r=r.replace(/\)[,] *(!*)\(/g,")||$1("),p=/[^ \d<>=!\|&,\(\)\-\+%x\.]/g,d=/[^ &!|\(] *\(/g,v=/\.[^\d]|[^\d]\./;if(r.match(p))throw new Error("PARSE.range: invalid characters found: "+r);if(r.match(d))throw new Error("PARSE.range: invalid character before opending bracket found: "+r);if(r.match(v))throw new Error("PARSE.range: invalid dot found: "+r);if(e.isArray(i)){s=-1,o=i.length;for(;++s<o;)u=parseInt(i[s],10),e.eval(r.replace(/x/g,u))&&a.push(u)}else while(!i.isFinished())u=parseInt(i.next(),10),e.eval(r.replace(/x/g,u))&&a.push(u);return a},"undefined"!=typeof Function.prototype.name?t.funcName=function(e){if("function"!=typeof e)throw new TypeError("PARSE.funcName: func must be function. Found: "+e);return e.name}:t.funcName=function(e){var t,n;if("function"!=typeof e)throw new TypeError("PARSE.funcName: func must be function. Found: "+e);return t=/function\s([^(]{1,})\(/,n=t.exec(e.toString()),n&&n.length>1?n[1].trim():""},e.extend(t)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function n(){this.queue=[],this.inProgress={}}var t={};t.getQueue=function(){return new n},n.prototype.isReady=function(){return e.isEmpty(this.inProgress)},n.prototype.onReady=function(t){if("function"!=typeof t)throw new TypeError("Queue.onReady: cb must be function. Found: "+t);e.isEmpty(this.inProgress)?t():this.queue.push(t)},n.prototype.add=function(t){if(t&&"string"!=typeof t)throw new Error("Queue.add: key must be string.");t=e.uniqueKey(this.inProgress,t);if("string"!=typeof t)throw new Error("Queue.add: an error occurred generating unique key.");return this.inProgress[t]=t,t},n.prototype.remove=function(t){if("string"!=typeof t)throw new Error("Queue.remove: key must be string.");delete this.inProgress[t],e.isEmpty(this.inProgress)&&this.executeAndClear()},n.prototype.getRemoveCb=function(e){var t;if("string"!=typeof e)throw new Error("Queue.getRemoveCb: key must be string.");return t=this,function(){t.remove(e)}},n.prototype.executeAndClear=function(){var e,t;e=-1,t=this.queue.length;for(;++e<t;)this.queue[e]()},e.extend(t)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function t(){}t.random=function(e,t){var n;if("undefined"==typeof t){if("undefined"==typeof e)return Math.random();t=e,e=0}return e===t?e:(t<e&&(n=e,e=t,t=n),Math.random()*(t-e)+e)},t.randomInt=function(e,n){return e===n?e:Math.floor(t.random(e,n)+1)},t.randomDate=function(){function e(e){return e&&Object.prototype.toString.call(e)==="[object Date]"&&!isNaN(e)}return function(t,n){if("undefined"==typeof t)t=new Date("1900");else if(!e(t))throw new TypeError("randomDate: startDate must be a valid date. Found: "+t);if("undefined"==typeof n)n=new Date;else if(!e(n))throw new TypeError("randomDate: endDate must be a valid date or undefined. Found: "+n);return new Date(t.getTime()+Math.random()*(n.getTime()-t.getTime()))}}(),t.sample=function(t,n){var r;return r=e.seq(t,n),r?e.shuffle(r):!1},t.getNormalGenerator=function(){return function(){var e,t,n,r,i;return function s(o,u){var a,f,l,c,h,p;if("number"!=typeof o)throw new TypeError("nextNormal: mu must be number.");if("number"!=typeof u)throw new TypeError("nextNormal: sigma must be number.");if(o!==e||u!==t)i=!1,e=o,t=u;return i?(i=!1,u*n+o):(f=Math.random(),l=Math.random(),c=2*f-1,h=2*l-1,p=c*c+h*h,p>=1?s(o,u):(r=Math.sqrt(-2*Math.log(p)/p),a=c*r,n=h*r,i=!0,u*a+o))}}()},t.nextNormal=t.getNormalGenerator(),t.nextLogNormal=function(e,n){if("number"!=typeof e)throw new TypeError("nextLogNormal: mu must be number.");if("number"!=typeof n)throw new TypeError("nextLogNormal: sigma must be number.");return Math.exp(t.nextNormal(e,n))},t.nextExponential=function(e){if("number"!=typeof e)throw new TypeError("nextExponential: lambda must be number.");if(e<=0)throw new TypeError("nextExponential: lambda must be greater than 0.");return-Math.log(1-Math.random())/e},t.nextBinomial=function(e,t){var n,r;if("number"!=typeof e)throw new TypeError("nextBinomial: p must be number.");if("number"!=typeof t)throw new TypeError("nextBinomial: trials must be number.");if(e<0||e>1)throw new TypeError("nextBinomial: p must between 0 and 1.");if(t<1)throw new TypeError("nextBinomial: trials must be greater than 0.");n=0,r=0;while(n<t)Math.random()<e&&(r+=1),n++;return r},t.nextGamma=function(e,t){var n,r,i,s,o,u,a,f,l;if("number"!=typeof e)throw new TypeError("nextGamma: alpha must be number.");if("number"!=typeof t)throw new TypeError("nextGamma: k must be number.");if(e<1)throw new TypeError("nextGamma: alpha must be greater than 1.");if(t<1)throw new TypeError("nextGamma: k must be greater than 1.");s=Math.random(),o=Math.random(),u=Math.random(),n=Math.floor(t)+3,r=1/t,i=1/e,a=0;for(f=3;++f<n;)a+=Math.log(Math.random());return a*=-i,l=Math.log(u)*(Math.pow(s,r)/(Math.pow(s,r)+Math.pow(o,1/(1-t)))),l*=-i,a+l},t.randomString=function(t,n,r){var i,s,o,u;if("undefined"!=typeof t)if("number"!=typeof t||t<1)throw new Error("randomString: len must a number > 0 or undefined. Found: "+t);if("undefined"!=typeof n){if("string"!=typeof n||n.trim()==="")throw new Error("randomString: chars must a non-empty string or undefined. Found: "+n)}else if(r)throw new Error("randomString: useChars is TRUE, but chars is undefined.");t=t||6,n=n||"a",i="";if(!r){n.indexOf("a")>-1&&(i+="abcdefghijklmnopqrstuvwxyz"),n.indexOf("A")>-1&&(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),n.indexOf("1")>-1&&(i+="0123456789"),n.indexOf("!")>-1&&(i+="!~`@#$%^&*()_+-={}[]:\";'<>?,./|\\"),u=n.indexOf("_");if(u>-1){u=n.charAt(u+1),u=e.isInt(u,0)||1;if(u===1)i+=" ";else if(u===2)i+="  ";else if(u===3)i+="   ";else{o=-1;for(;++o<u;)i+=" "}}}else i=n;o=-1,s="";for(;++o<t;)s+=i[Math.floor(Math.random()*i.length)];return s},t.randomEmail=function(){return t.randomString(t.randomInt(5,15),"!Aa0")+"@"+t.randomString(t.randomInt(3,10))+"."+t.randomString(t.randomInt(2,3))},e.extend(t)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function t(){}Date.prototype.toISOString||function(){function e(e){return e<10?"0"+e:e}Date.prototype.toISOString=function(){var t=(this.getUTCMilliseconds()/1e3).toFixed(3);return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+t.slice(2,5)+"Z"}}(),t.getDate=t.getFullDate=function(){return(new Date).toISOString()},t.getTime=function(){var e;return e=new Date,e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},t.getTimeM=function(){var e;return e=new Date,e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds()},t.parseMilliseconds=function(e){var t,n,r,i,s,o;if("number"!=typeof e)throw new TypeError("TIME.parseMilliseconds: ms must be number.");return t=[],n=e/1e3,t[4]=n,r=n%60,t[3]=Math.floor(r),n/=60,i=n%60,t[2]=Math.floor(i),n/=60,s=n%24,t[1]=Math.floor(s),n/=24,o=n,t[1]=Math.floor(o),t},t.now="function"==typeof Date.now?Date.now:function(){return(new Date).getTime()},e.extend(t)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS)